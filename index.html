<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF Editor - AI Destekli Metin Düzenleme</title>
    <meta name="description"
        content="PDF belgelerinizi AI yardımıyla düzenleyin. Seçtiğiniz alanları işaretleyin ve metni otomatik olarak yeniden oluşturun.">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="badges.css">
    <link rel="stylesheet" href="modal-styles.css">
    <!-- Local Libraries for Electron -->
    <script src="libs/pdf.min.js"></script>
    <script src="libs/pdf-lib.min.js"></script>
</head>

<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="logo">
                <svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <rect width="32" height="32" rx="8" fill="url(#gradient)" />
                    <path d="M9 12H23M9 16H23M9 20H17" stroke="white" stroke-width="2" stroke-linecap="round" />
                    <defs>
                        <linearGradient id="gradient" x1="0" y1="0" x2="32" y2="32">
                            <stop offset="0%" stop-color="#667eea" />
                            <stop offset="100%" stop-color="#764ba2" />
                        </linearGradient>
                    </defs>
                </svg>
                <h1>PDF Editor AI</h1>
            </div>
            <div class="header-actions">
                <button id="downloadBtn" class="btn btn-secondary" disabled>
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M7 10l5 5 5-5M12 15V3" stroke-width="2"
                            stroke-linecap="round" stroke-linejoin="round" />
                    </svg>
                    İndir
                </button>
            </div>
        </header>

        <div class="main-content">
            <!-- Sidebar -->
            <aside class="sidebar">
                <input type="file" id="fileInput" accept=".pdf" hidden>

                <div class="tools-section">
                    <h3>Araçlar</h3>
                    <div class="tool-group">
                        <button id="replaceTool" class="tool-btn active">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7" stroke-width="2"
                                    stroke-linecap="round" stroke-linejoin="round" />
                                <path d="M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z" stroke-width="2"
                                    stroke-linecap="round" stroke-linejoin="round" />
                            </svg>
                            Metin Değiştir
                        </button>
                        <button id="addTool" class="tool-btn">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <path d="M12 5v14M5 12h14" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round" />
                            </svg>
                            Metin Ekle
                        </button>
                        <button id="addImageTool" class="tool-btn">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <rect x="3" y="3" width="18" height="18" rx="2" ry="2" stroke-width="2"
                                    stroke-linecap="round" stroke-linejoin="round" />
                                <circle cx="8.5" cy="8.5" r="1.5" stroke-width="2" />
                                <path d="M21 15l-5-5L5 21" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round" />
                            </svg>
                            Görsel Ekle
                        </button>
                        <input type="file" id="imageInput" accept="image/jpeg,image/png,image/gif,image/webp" hidden>
                        <button id="removeObjectTool" class="tool-btn">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <path d="M20 5H9l-7 7 7 7h11a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2z" stroke-width="2"
                                    stroke-linecap="round" stroke-linejoin="round" />
                                <line x1="18" y1="9" x2="12" y2="15" stroke-width="2" stroke-linecap="round" />
                                <line x1="12" y1="9" x2="18" y2="15" stroke-width="2" stroke-linecap="round" />
                            </svg>
                            Obje Kaldır
                        </button>
                        <button id="moveTool" class="tool-btn">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <path d="M3 3l7.07 16.97 2.51-7.39 7.39-2.51L3 3z" stroke-width="2"
                                    stroke-linecap="round" stroke-linejoin="round" />
                                <path d="M13 13l6 6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                            </svg>
                            Seç / Taşı
                        </button>
                    </div>
                </div>

                <div class="annotations-section">
                    <h3>Düzenlemeler</h3>
                    <div id="annotationsList" class="annotations-list">
                        <p class="empty-state">Henüz düzenleme yok</p>
                    </div>
                </div>

                <!-- Inline Text Editor Panel -->
                <div id="textEditorPanel" class="text-editor-panel" style="display: none;">
                    <h3>Metin Düzenle</h3>
                    <div class="editor-content">
                        <div id="textInputWrapper">
                            <textarea id="textInput" placeholder="Metni buraya yazın..."></textarea>
                        </div>

                        <div class="editor-controls">
                            <div class="control-row" id="fontSizeRow">
                                <div class="control-group">
                                    <label>Font</label>
                                    <select id="fontFamily">
                                        <option value="Inter">Inter</option>
                                        <option value="Arial">Arial</option>
                                        <option value="Times New Roman">Times New Roman</option>
                                        <option value="Courier New">Courier New</option>
                                        <option value="Georgia">Georgia</option>
                                        <option value="Verdana">Verdana</option>
                                    </select>
                                </div>
                                <div class="control-group">
                                    <label>Boyut</label>
                                    <input type="number" id="fontSize" value="14" min="8" max="72">
                                </div>
                            </div>

                            <div class="control-row" id="colorStyleRow">
                                <div class="control-group">
                                    <label>Renk</label>
                                    <div class="color-picker-wrapper">
                                        <input type="color" id="textColor" value="#000000">
                                        <span id="colorValue">#000000</span>
                                        <button id="eyedropperBtn" class="eyedropper-btn" title="Canvas'tan renk al">
                                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none"
                                                stroke="currentColor" stroke-width="2">
                                                <path
                                                    d="M2 22l1-1h3l9-9M20.71 5.63l-2.34-2.34a1 1 0 00-1.41 0l-3.12 3.12-1.93-1.91-1.41 1.41 1.42 1.42L3 16.25V21h4.75l8.92-8.92 1.42 1.42 1.41-1.41-1.92-1.92 3.12-3.12a1 1 0 00.01-1.42z" />
                                            </svg>
                                        </button>
                                    </div>
                                </div>
                                <div class="control-group">
                                    <label>Stil</label>
                                    <div class="style-toggles unified">
                                        <label class="style-toggle">
                                            <input type="checkbox" id="fontBold">
                                            <span class="toggle-btn" title="Kalın">B</span>
                                        </label>
                                        <label class="style-toggle">
                                            <input type="checkbox" id="fontItalic">
                                            <span class="toggle-btn italic" title="İtalik">I</span>
                                        </label>
                                        <label class="style-toggle">
                                            <input type="radio" name="textAlign" id="alignLeft" value="left" checked>
                                            <span class="toggle-btn" title="Sola Hizala">
                                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none"
                                                    stroke="currentColor" stroke-width="2.5">
                                                    <line x1="3" y1="6" x2="21" y2="6"></line>
                                                    <line x1="3" y1="12" x2="15" y2="12"></line>
                                                    <line x1="3" y1="18" x2="18" y2="18"></line>
                                                </svg>
                                            </span>
                                        </label>
                                        <label class="style-toggle">
                                            <input type="radio" name="textAlign" id="alignCenter" value="center">
                                            <span class="toggle-btn" title="Ortala">
                                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none"
                                                    stroke="currentColor" stroke-width="2.5">
                                                    <line x1="3" y1="6" x2="21" y2="6"></line>
                                                    <line x1="6" y1="12" x2="18" y2="12"></line>
                                                    <line x1="4" y1="18" x2="20" y2="18"></line>
                                                </svg>
                                            </span>
                                        </label>
                                        <label class="style-toggle">
                                            <input type="radio" name="textAlign" id="alignRight" value="right">
                                            <span class="toggle-btn" title="Sağa Hizala">
                                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none"
                                                    stroke="currentColor" stroke-width="2.5">
                                                    <line x1="3" y1="6" x2="21" y2="6"></line>
                                                    <line x1="9" y1="12" x2="21" y2="12"></line>
                                                    <line x1="6" y1="18" x2="21" y2="18"></line>
                                                </svg>
                                            </span>
                                        </label>
                                        <label class="style-toggle pixelate-toggle">
                                            <input type="checkbox" id="pixelateText">
                                            <span class="toggle-btn" title="Piksellendir (Tarama Efekti)">
                                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none"
                                                    stroke="currentColor" stroke-width="2">
                                                    <rect x="3" y="3" width="6" height="6"></rect>
                                                    <rect x="15" y="3" width="6" height="6"></rect>
                                                    <rect x="3" y="15" width="6" height="6"></rect>
                                                    <rect x="15" y="15" width="6" height="6"></rect>
                                                    <rect x="9" y="9" width="6" height="6"></rect>
                                                </svg>
                                            </span>
                                        </label>
                                    </div>
                                </div>
                            </div>

                            <!-- Background Color Control - Only for replace/removeObject -->
                            <div class="control-row bg-color-row" id="bgColorRow" style="display: none;">
                                <div class="control-group">
                                    <label>Arka Plan Rengi</label>
                                    <div class="color-picker-wrapper">
                                        <input type="color" id="bgColor" value="#ffffff">
                                        <span id="bgColorValue">#FFFFFF</span>
                                        <button id="bgEyedropperBtn" class="eyedropper-btn"
                                            title="Canvas'tan arka plan rengi al">
                                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none"
                                                stroke="currentColor" stroke-width="2">
                                                <path
                                                    d="M2 22l1-1h3l9-9M20.71 5.63l-2.34-2.34a1 1 0 00-1.41 0l-3.12 3.12-1.93-1.91-1.41 1.41 1.42 1.42L3 16.25V21h4.75l8.92-8.92 1.42 1.42 1.41-1.41-1.92-1.92 3.12-3.12a1 1 0 00.01-1.42z" />
                                            </svg>
                                        </button>
                                    </div>
                                </div>
                                <div class="control-group">
                                    <!-- Empty for alignment with STİL column -->
                                </div>
                            </div>

                            <div class="control-row ai-option" id="aiOptionRow">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="useAI" checked>
                                    <span>AI ile font boyutunu eşleştir</span>
                                </label>
                            </div>

                        </div>

                        <div class="editor-actions">
                            <button class="btn btn-secondary" id="cancelEditBtn">İptal</button>
                            <button class="btn btn-primary" id="applyTextBtn">Uygula</button>
                        </div>
                    </div>
                </div>

                <div class="api-section">
                    <h3>AI Ayarları</h3>
                    <div class="input-group">
                        <label for="apiKey">Gemini API Key</label>
                        <div class="password-wrapper">
                            <input type="password" id="apiKey" placeholder="API anahtarınızı girin">
                            <button class="password-toggle" id="toggleApiKey" title="Göster/Gizle">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                    <circle cx="12" cy="12" r="3"></circle>
                                </svg>
                            </button>
                        </div>
                        <div class="api-status" id="apiStatus">
                            <span class="status-dot inactive"></span>
                            <span class="status-text">API anahtarı girilmedi</span>
                        </div>
                        <button class="btn btn-outline btn-sm" id="testApiBtn"
                            style="margin-top: 0.5rem; padding: 0.5rem 1rem; font-size: 0.8rem;">
                            API'yi Test Et
                        </button>
                        <small>Font eşleştirme için gerekli. <a href="https://aistudio.google.com/app/apikey"
                                target="_blank" style="color: var(--primary);">Anahtar al</a></small>
                    </div>
                </div>
            </aside>

            <!-- Canvas Area -->
            <main class="canvas-area">
                <!-- Tab Bar -->
                <div class="tab-bar" id="tabBar">
                    <div class="tabs-container" id="tabsContainer">
                        <!-- Tabs will be added dynamically -->
                        <!-- + button will be appended here after tabs -->
                    </div>
                </div>

                <div class="canvas-main-area">
                    <div id="dropZone" class="drop-zone">
                        <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z" stroke-width="2" />
                            <path d="M14 2v6h6M16 13H8M16 17H8M10 9H8" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round" />
                        </svg>
                        <h2>PDF belgesi yükleyin</h2>
                        <p>Dosyayı sürükleyip bırakın veya tıklayarak seçin</p>
                        <button class="btn btn-outline" onclick="document.getElementById('fileInput').click()">
                            Dosya Seç
                        </button>
                    </div>

                    <div id="canvasContainer" class="canvas-container" style="display: none;">
                        <div class="canvas-wrapper">
                            <!-- Rulers (CSS pattern based, no canvas needed) -->
                            <div class="ruler-corner"></div>
                            <div id="rulerHorizontal" class="ruler ruler-horizontal"></div>
                            <div id="rulerVertical" class="ruler ruler-vertical"></div>

                            <!-- Guide lines overlay (full screen) -->
                            <canvas id="guideCanvas" class="guide-overlay"></canvas>

                            <div class="canvas-holder">
                                <!-- Canvas stack ensures annotation canvas is EXACTLY over PDF canvas -->
                                <div class="canvas-stack">
                                    <canvas id="pdfCanvas"></canvas>
                                    <canvas id="annotationCanvas"></canvas>
                                </div>
                            </div>
                        </div>

                        <!-- Vertical Controls (Right Side) -->
                        <div class="vertical-controls">
                            <div class="zoom-controls-vertical">
                                <button id="zoomIn" class="control-btn zoom-btn" title="Yakınlaştır">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                        <circle cx="11" cy="11" r="8" stroke-width="2" />
                                        <path d="M21 21l-4.35-4.35M11 8v6M8 11h6" stroke-width="2"
                                            stroke-linecap="round" />
                                    </svg>
                                </button>
                                <span id="zoomLevel" class="zoom-level-vertical">100%</span>
                                <button id="zoomOut" class="control-btn zoom-btn" title="Uzaklaştır">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                        <circle cx="11" cy="11" r="8" stroke-width="2" />
                                        <path d="M21 21l-4.35-4.35M8 11h6" stroke-width="2" stroke-linecap="round" />
                                    </svg>
                                </button>
                            </div>
                            <div class="divider-vertical"></div>
                            <div class="page-controls-vertical">
                                <button id="prevPage" class="control-btn zoom-btn" disabled title="Önceki Sayfa">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                        stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                                        <polyline points="18,15 12,9 6,15"></polyline>
                                    </svg>
                                </button>
                                <div class="page-display">
                                    <span id="currentPage" class="current-page-box">1</span>
                                    <span id="totalPages" class="total-pages">1</span>
                                </div>
                                <button id="nextPage" class="control-btn zoom-btn" disabled title="Sonraki Sayfa">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                        stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                                        <polyline points="6,9 12,15 18,9"></polyline>
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <script src="script.js"></script>
</body>

</html>